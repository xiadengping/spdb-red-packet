{"version":3,"sources":["../../src/util/request.js"],"names":["Request","paramsSerializer","qs","key","params","push","encodeURI","join","getPgv","c","Math","round","random","Date","defaults","headers","httpAgent","httpsAgent","axios","create","cm","store","interceptors","request","use","config","url","decodeURIComponent","prepare","Promise","reject","err","response","setCookie","res","map","item","replace","options"],"mappings":";;;;;QAgBgBA,O,GAAAA,O;;AAhBhB;;;;AACA;;;;AACA;;;;AAEA,IAAMC,mBAAmB,SAAnBA,gBAAmB,SAAU;AACjC,MAAIC,KAAK,EAAT;AACA,OAAK,IAAIC,GAAT,IAAgBC,MAAhB,EAAwB;AACtBF,OAAGG,IAAH,CAAWF,GAAX,SAAkBC,OAAOD,GAAP,CAAlB;AACD;AACD,SAAOG,UAAUJ,GAAGK,IAAH,CAAQ,GAAR,CAAV,CAAP;AACD,CAND;;AAQA,IAAMC,SAAS,SAATA,MAAS,IAAK;AAClB,SAAO,CAACC,KAAK,EAAN,IAAYC,KAAKC,KAAL,CAAW,cAAcD,KAAKE,MAAL,MAAiB,EAA/B,CAAX,IAAiD,CAAC,IAAIC,IAAJ,EAAlD,GAA6D,IAAhF;AACD,CAFD;;AAIO,SAASb,OAAT,CAAkBc,QAAlB,EAA4B;AAAA;;AACjCA,aAAWA,YAAY,EAAvB;AACAA,WAASC,OAAT,GAAmBD,SAASC,OAAT,IAAoB,EAAvC;AACA,MAAI,6BAAJ,EAA2B;AACzBD,aAASC,OAAT,CAAiB,YAAjB,IAAiCD,SAASC,OAAT,CAAiB,YAAjB,KAAkC,2HAAnE;AACAD,aAASC,OAAT,CAAiB,YAAjB,IAAiCD,SAASC,OAAT,CAAiB,YAAjB,KAAkC,OAAnE;AACD;AACD;AACA;AACAD,WAASE,SAAT,GAAqB,KAArB;AACAF,WAASG,UAAT,GAAsB,KAAtB;;AAEA,OAAKC,KAAL,GAAa,gBAAMC,MAAN,CAAaL,QAAb,CAAb;AACA,MAAI,6BAAJ,EAA2B;AACzB,SAAKM,EAAL,GAAU,6BAAV;AACA,SAAKA,EAAL,CAAQC,KAAR,CAAc,EAAd,EAAkB,CAAC,aAAab,QAAb,GAAwB,0BAAzB,EAAqD,YAAYA,OAAO,GAAP,CAAZ,GAA0B,0BAA/E,CAAlB;AACA,SAAKU,KAAL,CAAWI,YAAX,CAAwBC,OAAxB,CAAgCC,GAAhC,CAAoC,kBAAU;AAC5CC,aAAOV,OAAP,CAAe,QAAf,IAA2BU,OAAOC,GAAP,GAAaC,mBAAmB,MAAKP,EAAL,CAAQQ,OAAR,CAAgBH,OAAOC,GAAvB,CAAnB,CAAb,GAA+D,EAA1F;AACA,aAAOD,MAAP;AACD,KAHD,EAGG,eAAO;AACR,aAAOI,QAAQC,MAAR,CAAeC,GAAf,CAAP;AACD,KALD;AAMA,SAAKb,KAAL,CAAWI,YAAX,CAAwBU,QAAxB,CAAiCR,GAAjC,CAAqC,eAAO;AAC1C,UAAIS,YAAYC,IAAInB,OAAJ,CAAY,YAAZ,CAAhB;AACA,UAAIkB,SAAJ,EAAe;AACb,cAAKb,EAAL,CAAQC,KAAR,CAAca,IAAIT,MAAJ,CAAWC,GAAzB,EAA8BO,UAAUE,GAAV,CAAc,gBAAQ;AAClD,iBAAOC,KAAKC,OAAL,CAAa,gDAAb,EAA+D,IAA/D,CAAP;AACD,SAF6B,CAA9B;AAGD;AACD,aAAOH,GAAP;AACD,KARD,EAQG,eAAO;AACR,aAAOL,QAAQC,MAAR,CAAeC,GAAf,CAAP;AACD,KAVD;AAWD;;AAED,OAAKR,OAAL,GAAe,mBAAW;AACxB,WAAO,MAAKL,KAAL,CAAWK,OAAX,CAAmBe,OAAnB,CAAP;AACD,GAFD;;AAIA,SAAO,KAAKf,OAAZ;AACD","file":"request.js","sourcesContent":["import axios from 'axios'\nimport CM from 'cookie-manager'\nimport {isStandardBrowserEnv} from './global'\n\nconst paramsSerializer = params => {\n  let qs = []\n  for (let key in params) {\n    qs.push(`${key}=${params[key]}`)\n  }\n  return encodeURI(qs.join('&'))\n}\n\nconst getPgv = c => {\n  return (c || \"\") + Math.round(2147483647 * (Math.random() || .5)) * +new Date % 1E10\n}\n\nexport function Request (defaults) {\n  defaults = defaults || {}\n  defaults.headers = defaults.headers || {}\n  if (!isStandardBrowserEnv) {\n    defaults.headers['user-agent'] = defaults.headers['user-agent'] || 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.109 Safari/537.36'\n    defaults.headers['connection'] = defaults.headers['connection'] || 'close'\n  }\n  // 好像不需要了\n  // defaults.paramsSerializer = defaults.paramsSerializer || paramsSerializer\n  defaults.httpAgent = false\n  defaults.httpsAgent = false\n\n  this.axios = axios.create(defaults)\n  if (!isStandardBrowserEnv) {\n    this.cm = new CM()\n    this.cm.store('', ['pgv_pvi=' + getPgv() + '; Domain=.qq.com; Path=/', 'pgv_si=' + getPgv('s') + '; Domain=.qq.com; Path=/'])\n    this.axios.interceptors.request.use(config => {\n      config.headers['cookie'] = config.url ? decodeURIComponent(this.cm.prepare(config.url)) : ''\n      return config\n    }, err => {\n      return Promise.reject(err)\n    })\n    this.axios.interceptors.response.use(res => {\n      let setCookie = res.headers['set-cookie']\n      if (setCookie) {\n        this.cm.store(res.config.url, setCookie.map(item => {\n          return item.replace(/\\=\\s*?(?=(\\w+\\.)*(wx\\d?\\.qq\\.com|wechat\\.com))/, '=.')\n        }))\n      }\n      return res\n    }, err => {\n      return Promise.reject(err)\n    })\n  }\n\n  this.request = options => {\n    return this.axios.request(options)\n  }\n\n  return this.request\n}\n"]}